# This is a template Makefile generated by rpcgen
.PHONY: all clean

# Parameters

CLIENT = msg_client
SERVER = msg_server

XDR_SOURCES = msg.x

CLIENT_SRC = msg_client.c
CLIENT_STUB_SRC = msg_clnt.c
CLIENT_OBJECTS = $(CLIENT_SRC:%.c=%.o) $(CLIENT_STUB_SRC:%.c=%.o)
SERVER_SRC  = msg_server.c
SERVER_STUB_SRC = msg_svc.c
SERVER_OBJECTS = $(SERVER_SRC:%.c=%.o) $(SERVER_STUB_SRC:%.c=%.o)
XDR_HEADER = $(XDR_SOURCES:%.x=%.h)
RPCGEN_GENFILES = $(XDR_HEADER) $(SERVER_STUB_SRC) $(CLIENT_STUB_SRC)

# Compiler flags

CFLAGS += -g -fPIC $(shell pkg-config --cflags libtirpc)
LDLIBS += -shared $(shell pkg-config --libs libtirpc)
RPCGENFLAGS =

# Targets
all : $(CLIENT) $(SERVER)

$(CLIENT): $(CLIENT_OBJECTS)
	$(LINK.c) $(LDLIBS) -o $@ $^

$(SERVER) : $(SERVER_OBJECTS)
	$(LINK.c) -o $@ $^ $(LDLIBS)

$(RPCGEN_GENFILES): $(XDR_SOURCES)
	rpcgen $(RPCGENFLAGS) $^

$(CLIENT_OBJECTS): $(XDR_HEADER)

clean:
	 $(RM) core $(CLIENT_OBJECTS) $(SERVER_OBJECTS) $(RPCGEN_GENFILES) $(CLIENT_STUB_SRC) $(SERVER_STUB_SRC) $(CLIENT) $(SERVER) *~
